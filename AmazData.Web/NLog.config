<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Warn"
      internalLogFile="logs/internal-nlog.txt">

    <!-- 加载 ASP.NET Core 与 OrchardCore 日志扩展 -->
    <extensions>
        <add assembly="NLog.Web.AspNetCore" />
        <add assembly="OrchardCore.Logging.NLog" />
    </extensions>

    <targets>
        <!-- ✅ 文件输出：每天生成一个日志文件，并自动归档 -->
        <target xsi:type="File" name="file"
                fileName="logs/orchard-log-${shortdate}.log"
                maxArchiveFiles="10"
                archiveNumbering="Rolling"
                concurrentWrites="true"
                keepFileOpen="false"
                layout="${longdate}|${orchard-tenant-name}|${aspnet-traceidentifier}|${event-properties:item=EventId}|${logger}|${uppercase:${level}}|${message} ${exception:format=ToString,StackTrace}" />

        <!-- ✅ 控制台输出：彩色日志，方便调试 -->
        <target xsi:type="ColoredConsole" name="console"
                layout="${longdate}|${orchard-tenant-name}|${uppercase:${level}}|${logger}|${message} ${exception:format=ToString,StackTrace}">
            <highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="White" />
            <highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
            <highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
            <highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
            <highlight-row condition="level == LogLevel.Debug" foregroundColor="Gray" />
            <highlight-row condition="level == LogLevel.Trace" foregroundColor="DarkGray" />
        </target>
    </targets>

    <rules>
        <!-- ✅ 主规则：所有日志从 Info 级别开始输出到 文件 + 控制台 -->
        <!-- 如果要调试 MQTT 服务可改为 minlevel="Debug" 或 "Trace" -->
        <logger name="*" minlevel="Info" writeTo="file, console" />

        <!-- ✅ 记录 ASP.NET Core 请求日志 -->
        <logger name="Microsoft.AspNetCore" minlevel="Warning" writeTo="file, console" />

        <!-- ✅ OrchardCore Shell 初始化日志 -->
        <logger name="OrchardCore.Environment.Shell" minlevel="Info" writeTo="file, console" />
    </rules>
</nlog>